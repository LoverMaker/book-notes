## MySQL性能优化思路

### 商业需求对性能的影响

* 不合理需求造成资源投入产出比过低
  * 性能与实时性、准确性的权衡
* 无用功能堆积使系统过度复杂影响整体性能
  * 上线功能简单，下线功能难
  * 系统臃肿，维护困难，资源消耗大

### 系统架构及实现对性能的影响

* 数据库中只存合适类型的数据
  * 二进制多媒体数据、流水队列数据、超大文本数据不适合数据库
* 变化相对较少的数据Cache到内存
  * 适合使用Cache技术来提高系统性能的数据
    * 系统各种配置及规则数据
    * 活跃用户的基本信息数据
    * 活跃用户的个性化定制信息数据
    * 准实时的统计信息数据
    * 其他一些访问频繁但变更较少的数据
  * Cache 系统的不合理利用导致Cache 命中率低下造成数据库访问量的增加，同时也浪费了Cache
    系统的硬件资源投入
* 过度依赖数据库SQL 语句的功能造成数据库操作效率低下
  * 将复杂SQL拆分成多条简单SQL，减少对大表的不必要访问
* 过度依赖面向对象思想，对系统
* 重复执行相同的SQL 造成资源浪费
* 数据过于离散
  * 对可扩展性的过渡追求，促使系统设计的时候将对象拆得过于离散，造成系统中大量的复杂Join
    语句，而MySQL Server 在各数据库系统中的主要优势在于处理简单逻辑的查询，这与其锁定的机制也有较大关系

### Query语句对系统性能的影响

* 数据查询流程
  * SQL Parse ->查询优化器得到执行计划 -> 调用存储引擎接口取数据 -> 整理结果集返回数据
* 通过执行计划分析SQL查询，可通过profile数据验证

### Schema设计对系统的性能影响

* 功能上做到尽可能容易扩展，再根据数据库范式规则进行调整，做到第三范式或者第四范式
* 拆分热点字段与数据量较大字段对性能也有所提升

### 硬件环境对系统性能的影响

* IOPS: IO吞吐量
  * 在主机中决定IO 性能部件主要由磁盘和内存所决定，当
    然也包括各种与IO 相关的板卡。
* 典型OLTP 应用系统
  * 扩大内存容量来尽可能多的将活跃数据cache 到内存中
  * 对磁盘存储的要求是IOPS 表现要很好，吞吐量是次要因素
  * 并发量很高，CPU 每秒所要处理的请求自然也就很多，所以CPU 处理能力需要比较强劲
  * 网络设备对流量能力的要求不能太弱
* 典型OLAP 应用系统
  * 数据量非常大，所以磁盘存储系统的单位容量需要尽量大一些
  * 单次访问数据量较大，而且访问数据比较集中，那么对IO 系统的性能要求是需要有尽可能大的每秒
    IO 吞吐量，所以应该选用每秒吞吐量尽可能大的磁盘；
  * 虽然IO 性能要求也比较高，但是并发请求较少，所以CPU 处理能力较难成为性能瓶颈，所以CPU 处
    理能力没有太苛刻的要求；
  * 虽然每次请求的访问量很大，但是执行过程中的数据大都不会返回给客户端，最终返回给客户端的
    数据量都较小，所以和客户端交互的网络设备要求并不是太高；
  * 最好多台主机构成集群，并行化运算

### 总结

* 优化收益占比
  * 需求和架构及业务实现优化：55%
    Query 语句的优化：30%
    数据库自身的优化：15%